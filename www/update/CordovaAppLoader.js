var CordovaAppLoader=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){function d(a){var b=Object.keys(a);b.sort();var c="";return b.forEach(function(b){a[b]&&a[b].version,c+="@"+a[b].version}),f.hash(c)+""}function e(a){if(!a)throw new Error("CordovaAppLoader has no options!");if(!a.fs)throw new Error('CordovaAppLoader has no "fs" option (cordova-promise-fs)');if(!a.serverRoot)throw new Error('CordovaAppLoader has no "serverRoot" option.');if(!window.pegasus||!window.Manifest)throw new Error("CordovaAppLoader bootstrap.js is missing.");this.allowServerRootFromManifest=a.allowServerRootFromManifest===!0,g=a.fs.Promise,this.manifest=window.Manifest,this.newManifest=null,this.bundledManifest=null,this._lastUpdateFiles=localStorage.getItem("last_update_files"),a.serverRoot=a.serverRoot||"",a.serverRoot&&"/"!==a.serverRoot[a.serverRoot.length-1]&&(a.serverRoot+="/"),this.newManifestUrl=a.manifestUrl||a.serverRoot+(a.manifest||"manifest.json"),a.mode&&(a.mode="mirror"),this.cache=new f(a),this.corruptNewManifest=!1,this._toBeCopied=[],this._toBeDeleted=[],this._toBeDownloaded=[],this._updateReady=!1,this._checkTimeout=a.checkTimeout||1e4}var f=c(1),g=null,h=location.href.replace(location.hash,"");h=h.substr(0,h.lastIndexOf("/")+1),/ip(hone|ad|od)/i.test(navigator.userAgent)&&(h=location.pathname.substr(location.pathname.indexOf("/www/")),h=h.substr(0,h.lastIndexOf("/")+1),h="cdvfile://localhost/bundle"+h),e.prototype._createFilemap=function(a){var b={},c=this.cache._fs.normalize;return Object.keys(a).forEach(function(d){a[d].filename=c(a[d].filename),b[a[d].filename]=a[d]}),b},e.prototype.copyFromBundle=function(a){var b=h+a;return this.cache._fs.download(b,this.cache.localRoot+a)},e.prototype.getBundledManifest=function(){var a=this,b=document.querySelector("script[manifest]"),c=(b?b.getAttribute("manifest"):null)||"manifest.json";return new g(function(b,d){a.bundledManifest?b(a.bundledManifest):(pegasus(c).then(function(c){a.bundledManifest=c,b(c)},d),setTimeout(function(){d(new Error("bundled manifest timeout"))},a._checkTimeout))})},e.prototype.check=function(a){var b=this,c=this.manifest;"string"==typeof a&&(b.newManifestUrl=a,a=void 0);var e=new g(function(c,d){"object"==typeof a?c(a):(pegasus(b.newManifestUrl).then(c,d),setTimeout(function(){d(new Error("new manifest timeout"))},b._checkTimeout))});return new g(function(a,f){g.all([e,b.getBundledManifest(),b.cache.list()]).then(function(e){var g=e[0],h=e[1],i=d(g.files);if(i===b._lastUpdateFiles){var j=d(Manifest.files);return b._lastUpdateFiles!==j&&(console.warn("New manifest available, but an earlier update attempt failed. Will not download."),b.corruptNewManifest=!0,a(null)),void a(!1)}if(!g.files)return void f('Downloaded Manifest has no "files" attribute.');var k=e[2],l=b._createFilemap(c.files),i=b._createFilemap(g.files),m=b._createFilemap(h.files);b._toBeDownloaded=[],b._toBeCopied=[],b._toBeDeleted=[];var n=b.cache._fs.isCordova;Object.keys(i).filter(function(a){return!l[a]||l[a].version!==i[a].version||!b.cache.isCached(a)}).forEach(function(a){n&&m[a]&&m[a].version===i[a].version?b._toBeCopied.push(a):b._toBeDownloaded.push(a)}),b._toBeDeleted=k.map(function(a){return a.substr(b.cache.localRoot.length)}).filter(function(a){return!i[a]||b._toBeDownloaded.indexOf(a)>=0||b._toBeCopied.indexOf(a)>=0});var o=b._toBeDeleted.length+b._toBeDownloaded.length;o>0?(b.newManifest=g,b.newManifest.root=b.cache.localInternalURL,b.newManifest.localroot=b.cache.localUrl,a(!0)):a(!1)},function(a){f(a)})})},e.prototype.canDownload=function(){return!!this.newManifest&&!this._updateReady},e.prototype.canUpdate=function(){return this._updateReady},e.prototype.download=function(a){var b=this;return b.canDownload()?(localStorage.removeItem("manifest"),localStorage.setItem("last_update_files",d(this.newManifest.files)),this.manifest.files=Manifest.files={},b.cache.remove(b._toBeDeleted,!0).then(function(){return g.all(b._toBeCopied.map(function(a){return b.cache._fs.download(h+a,b.cache.localRoot+a)}))}).then(function(){return b.allowServerRootFromManifest&&b.newManifest.serverRoot&&(b.cache.serverRoot=b.newManifest.serverRoot),b.cache.add(b._toBeDownloaded),b.cache.download(a)}).then(function(){return b._toBeDeleted=[],b._toBeDownloaded=[],b._updateReady=!0,b.newManifest},function(a){return a&&a.length&&b.cache.remove(a),a})):new g(function(a){a(null)})},e.prototype.update=function(a){return this._updateReady?(this.newManifest.localroot=this.cache.localUrl,localStorage.setItem("manifest",JSON.stringify(this.newManifest)),a!==!1&&location.reload(),!0):!1},e.prototype.clear=function(){return localStorage.removeItem("last_update_files"),localStorage.removeItem("manifest"),this.cache.clear()},e.prototype.reset=function(){return this.clear().then(function(){location.reload()},function(){location.reload()})},a.exports=e},function(a,b,c){function d(a){var b=this;if(this._fs=a.fs,!this._fs)throw new Error('Missing required option "fs". Add an instance of cordova-promise-fs.');f=this._fs.Promise,this._mirrorMode="hash"!==a.mode,this._retry=a.retry||[500,1500,8e3],this._cacheBuster=!!a.cacheBuster,this.localRoot=this._fs.normalize(a.localRoot||"data"),this.serverRoot=this._fs.normalize(a.serverRoot||""),this._downloading=[],this._added=[],this._cached={},this.ready=this._fs.ensure(this.localRoot).then(function(a){return b.localInternalURL=g?a.toInternalURL():a.toURL(),b.localUrl=a.toURL(),b.list()})}var e=c(2),f=null,g="undefined"!=typeof cordova;d.hash=e,d.prototype.list=function(){var a=this;return new f(function(b){a._fs.list(a.localRoot,"rfe").then(function(c){a._cached={},c=c.map(function(b){var c=a._fs.normalize(b.fullPath);return a._cached[c]={toInternalURL:g?b.toInternalURL():b.toURL(),toURL:b.toURL()},c}),b(c)},function(){b([])})})},d.prototype.add=function(a){a||(a=[]),"string"==typeof a&&(a=[a]);var b=this;return a.forEach(function(a){a=b.toServerURL(a),-1===b._added.indexOf(a)&&b._added.push(a)}),b.isDirty()},d.prototype.remove=function(a,b){a||(a=[]);var c=[];"string"==typeof a&&(a=[a]);var d=this;return a.forEach(function(a){var b=d._added.indexOf(d.toServerURL(a));b>=0&&d._added.splice(b,1);var e=d.toPath(a);c.push(d._fs.remove(e)),delete d._cached[e]}),b?f.all(c):d.isDirty()},d.prototype.getDownloadQueue=function(){var a=this,b=a._added.filter(function(b){return!a.isCached(b)});return b},d.prototype.getAdded=function(){return this._added},d.prototype.isDirty=function(){return this.getDownloadQueue().length>0},d.prototype.download=function(a){var b=this._fs,c=this;return c.abort(),new f(function(d,e){b.ensure(c.localRoot).then(function(){return c.list()}).then(function(){if(!c.isDirty())return void d(c);var f=c.getDownloadQueue(),g=[],h=c._downloading.length,i=c._downloading.length,j=c._downloading.length+f.length;f.forEach(function(f){var k,l=c.toPath(f);"function"==typeof a&&(k=function(b){b.queueIndex=h,b.queueSize=j,b.url=f,b.path=l,b.percentage=h/j,b.loaded>0&&b.total>0&&h!==j&&(b.percentage+=b.loaded/b.total/j),g.indexOf(f)<0&&(g.push(f),h++),a(b)});var m=function(){i++,i===j&&(c._downloading=[],c.list().then(function(){k&&k(new ProgressEvent),c.isDirty()?e(c.getDownloadQueue()):d(c)},e))},n=f;c._cacheBuster&&(n+="?"+Date.now());var o=b.download(n,l,{retry:c._retry},k);o.then(m,m),c._downloading.push(o)})},e)})},d.prototype.abort=function(){this._downloading.forEach(function(a){a.abort()}),this._downloading=[]},d.prototype.isCached=function(a){return a=this.toPath(a),!!this._cached[a]},d.prototype.clear=function(){var a=this;return this._cached={},this._fs.removeDir(this.localRoot).then(function(){return a._fs.ensure(a.localRoot)})},d.prototype.toInternalURL=function(a){return path=this.toPath(a),this._cached[path]?this._cached[path].toInternalURL:a},d.prototype.get=function(a){return path=this.toPath(a),this._cached[path]?this._cached[path].toInternalURL:this.toServerURL(a)},d.prototype.getForHtml=function(a){return path=this.toPath(a),this._cached[path]?this._cached[path].toURL:this.toServerURL(a)},d.prototype.toDataURL=function(a){return this._fs.toDataURL(this.toPath(a))},d.prototype.toURL=function(a){return path=this.toPath(a),this._cached[path]?this._cached[path].toURL:a},d.prototype.toServerURL=function(a){return a=this._fs.normalize(a),a.indexOf("://")<0?this.serverRoot+a:a},d.prototype.toPath=function(a){if(this._mirrorMode){var b=a.indexOf("?");return b>-1&&(a=a.substr(0,b)),a=a=this._fs.normalize(a||""),len=this.serverRoot.length,a.substr(0,len)!==this.serverRoot?this.localRoot+a:this.localRoot+a.substr(len)}return this.localRoot+e(a)+a.substr(a.lastIndexOf("."))},a.exports=d},function(a){function b(a,b){var c,d,e,f,g,h,i,j;for(c=3&a.length,d=a.length-c,e=b,g=3432918353,h=461845907,j=0;d>j;)i=255&a.charCodeAt(j)|(255&a.charCodeAt(++j))<<8|(255&a.charCodeAt(++j))<<16|(255&a.charCodeAt(++j))<<24,++j,i=(65535&i)*g+(((i>>>16)*g&65535)<<16)&4294967295,i=i<<15|i>>>17,i=(65535&i)*h+(((i>>>16)*h&65535)<<16)&4294967295,e^=i,e=e<<13|e>>>19,f=5*(65535&e)+((5*(e>>>16)&65535)<<16)&4294967295,e=(65535&f)+27492+(((f>>>16)+58964&65535)<<16);switch(i=0,c){case 3:i^=(255&a.charCodeAt(j+2))<<16;case 2:i^=(255&a.charCodeAt(j+1))<<8;case 1:i^=255&a.charCodeAt(j),i=(65535&i)*g+(((i>>>16)*g&65535)<<16)&4294967295,i=i<<15|i>>>17,i=(65535&i)*h+(((i>>>16)*h&65535)<<16)&4294967295,e^=i}return e^=a.length,e^=e>>>16,e=2246822507*(65535&e)+((2246822507*(e>>>16)&65535)<<16)&4294967295,e^=e>>>13,e=3266489909*(65535&e)+((3266489909*(e>>>16)&65535)<<16)&4294967295,e^=e>>>16,e>>>0}a.exports=b}]);